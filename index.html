<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>DeutschMeister</title>
  <link rel="icon" href="icon.png" />
  <meta name="description" content="DeutschMeister - Your personal German learning companion.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="DeutschMeister">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1e1e3f">
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0" />
</head>

<body>

  <div id="app-loader" class="app-loader">
    <div class="spinner"></div>
  </div>
  <div id="toast-container"></div>

  <div id="auth-container" class="auth-container hidden">
    <div class="auth-layout">
      <div class="auth-branding">
        <h1 class="logo">DeutschMeister</h1>
        <p>Your journey to German fluency starts here.</p>
      </div>
      <div class="auth-form-container">
        <!-- Login Form -->
        <form id="login-form" class="auth-form">
          <h2>Welcome Back</h2>
          <div class="input-group"><label for="login-email">Email</label><input type="email" id="login-email" required
              autocomplete="username"></div>
          <div class="input-group"><label for="login-password">Password</label><input type="password"
              id="login-password" required autocomplete="current-password"></div>
          <p class="forgot-password-text"><a href="#" id="forgot-password-link">Forgot Password?</a></p>
          <p id="login-error" class="error-message"></p><button type="submit" class="btn btn-primary">Login</button>
          <p class="toggle-form-text">No account? <a href="#" id="show-signup">Sign up</a></p>
        </form>

        <!-- Signup Form -->
        <form id="signup-form" class="auth-form hidden">
          <h2>Create Your Account</h2>
          <div class="input-group"><label for="signup-name">Display Name</label><input type="text" id="signup-name"
              required autocomplete="name"></div>
          <div class="input-group"><label for="signup-email">Email</label><input type="email" id="signup-email" required
              autocomplete="username"></div>
          <div class="input-group"><label for="signup-password">Password</label><input type="password"
              id="signup-password" minlength="6" required autocomplete="new-password"></div>
          <p id="signup-error" class="error-message"></p><button type="submit" class="btn btn-primary">Sign Up</button>
          <p class="toggle-form-text">Already have an account? <a href="#" id="show-login">Login</a></p>
        </form>

        <!-- Forgot Password Form -->
        <form id="forgot-password-form" class="auth-form hidden">
          <h2>Reset Password</h2>
          <p class="form-description">Enter your email address and we'll send you a link to reset your password.</p>
          <div class="input-group">
            <label for="forgot-email">Email</label>
            <input type="email" id="forgot-email" required autocomplete="username">
          </div>
          <p id="forgot-error" class="error-message"></p>
          <button type="submit" class="btn btn-primary">Send Reset Link</button>
          <p class="toggle-form-text"><a href="#" id="back-to-login">← Back to Login</a></p>
        </form>
      </div>
    </div>
  </div>

  <div id="app-container" class="app-container hidden">
    <aside id="sidebar" class="sidebar">
      <div class="sidebar-header">
        <h1 class="logo">DeutschMeister</h1>
        <button id="close-sidebar-btn" class="icon-btn" aria-label="Close Menu">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      <nav class="sidebar-nav">
        <a href="#home" class="nav-link active" data-view="home"><span
            class="material-symbols-outlined">home</span>Home</a>
        <a href="#courses" class="nav-link" data-view="courses"><span
            class="material-symbols-outlined">school</span>Courses</a>
        <a href="#grammar" class="nav-link" data-view="grammar"><span
            class="material-symbols-outlined">menu_book</span>Grammar</a>
        <a href="#quizzes" class="nav-link" data-view="quizzes"><span
            class="material-symbols-outlined">quiz</span>Quizzes</a>
        <a href="#profile" class="nav-link" data-view="profile"><span
            class="material-symbols-outlined">person</span>Profile</a>
      </nav>
      <div class="sidebar-footer">
        <button id="install-app-btn" class="btn install-btn hidden">
          <span class="material-symbols-outlined">download</span>
          <span>Install App</span>
        </button>
      </div>
    </aside>

    <main class="main-content">
      <header class="main-header">
        <button id="hamburger-btn" class="icon-btn" aria-label="Open Menu">
          <span class="material-symbols-outlined">menu</span>
        </button>
        <div class="main-header-actions">
          <button id="dark-mode-toggle" class="icon-btn" aria-label="Toggle Dark Mode">
            <span class="material-symbols-outlined">dark_mode</span>
          </button>
          <button id="logout-btn" class="btn btn-secondary">Logout</button>
        </div>
      </header>

      <div id="password-reset-view" class="view hidden">
        <header class="view-header"><h2>Reset Your Password</h2><p>Enter and confirm your new password below.</p></header>
        <div class="reset-password-form-container">
          <form id="password-reset-form">
            <input type="email" id="reset-email" class="hidden" autocomplete="username">
            <div class="input-group"><label for="reset-new-password">New Password</label><input type="password" id="reset-new-password" minlength="6" required autocomplete="new-password"></div>
            <p id="reset-error" class="error-message"></p><button type="submit" class="btn btn-primary">Save New Password</button>
          </form>
        </div>
      </div>

      <div id="home-view" class="view">
        <header class="view-header"><h2 id="welcome-message"></h2><p>Welcome to your personalized learning dashboard.</p></header>
        <div id="home-content">
          <section id="user-dashboard-section" class="user-dashboard">
            <div class="dashboard-stats">
              <div class="progress-ring-card">
                <div class="progress-ring"><svg class="progress-ring__svg" width="120" height="120"><circle class="progress-ring__circle-bg" stroke-width="8" fill="transparent" r="52" cx="60" cy="60" /><circle id="progress-ring-circle" class="progress-ring__circle" stroke-width="8" fill="transparent" r="52" cx="60" cy="60" /></svg><span id="progress-ring-text" class="progress-ring__text">0%</span></div>
                <p>Overall Completion</p>
              </div>
              <div class="stat-card">
                <div class="stat-card-content"><h3 id="stat-videos-completed">0</h3><p>Videos Completed</p></div>
                <span class="material-symbols-outlined stat-card-icon">smart_display</span>
              </div>
            </div>
            <div class="recent-activity"><h3>Continue Watching</h3><div id="activity-list" class="activity-list"></div></div>
          </section>
        </div>
      </div>
      <div id="courses-view" class="view hidden">
        <header class="view-header"><h2>All Courses</h2><p>Browse all available courses from A1 to C1.</p></header>
        <div id="courses-container"></div>
      </div>
      <div id="grammar-view" class="view hidden">
        <header class="view-header"><h2>Grammar Guides</h2><p>Detailed explanations of German grammar concepts.</p></header>
        <div id="grammar-content" class="placeholder-content"><span class="material-symbols-outlined">construction</span><h2>Coming Soon...</h2></div>
      </div>
      <div id="quizzes-view" class="view hidden">
        <header class="view-header"><h2>Quizzes</h2><p>Test your knowledge for each course level.</p></header>
        <div id="quizzes-container" class="courses-grid"></div>
      </div>
      <div id="profile-view" class="view hidden">
        <header class="view-header"><h2>My Profile</h2><p>Manage your account and preferences.</p></header>
        <div class="profile-layout">
          <div class="profile-card">
            <div class="profile-avatar-container" id="pfp-container"></div>
            <input type="file" id="pfp-upload-input" class="hidden" accept="image/*">
            <div class="profile-details"><h3 id="profile-name"></h3><p id="profile-email"></p></div>
            <div class="profile-settings-card">
              <h3>Account Settings</h3>
              <div class="settings-options">
                <button id="change-password-btn" class="btn btn-secondary">Change Password</button>
                <button id="reset-all-progress-btn" class="btn btn-danger">Reset All Progress</button>
                <button id="delete-account-btn" class="btn btn-danger">Delete Account</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="video-player-view" class="view hidden">
        <header class="player-header">
          <button id="back-to-courses-btn" class="btn btn-secondary">← Courses</button>
          <h2 id="video-view-title"></h2>
          <button id="reset-course-btn" class="btn btn-danger">Reset Progress</button>
        </header>
        <div class="video-layout"><div id="youtube-player-container"></div><div id="video-list"></div></div>
      </div>
      <div id="quiz-view" class="view hidden">
        <header class="player-header"><h2 id="quiz-title"></h2></header>
        <div id="quiz-content"></div>
        <div id="quiz-results" class="quiz-results hidden">
          <h3>Quiz Complete!</h3><p id="quiz-score"></p>
          <div class="quiz-results-actions"><button id="quiz-retry-btn" class="btn btn-primary">Retry Quiz</button><button id="quiz-back-btn" class="btn btn-secondary">Back to Courses</button></div>
        </div>
      </div>
      
      <!-- NEW FAQ VIEW -->
      <div id="faq-view" class="view hidden">
        <header class="view-header"><h2>Frequently Asked Questions</h2><p>Find answers to common questions below.</p></header>
        <div class="faq-content">
          <details class="faq-item">
            <summary>Is DeutschMeister completely free?</summary>
            <p>Yes, all video lessons and learning materials on DeutschMeister are provided free of charge. Our mission is to make learning German accessible to everyone.</p>
          </details>
          <details class="faq-item">
            <summary>How is my progress saved?</summary>
            <p>Your progress, including completed videos and lesson timestamps, is automatically saved to your account. You can sign in on any device and pick up right where you left off.</p>
          </details>
          <details class="faq-item">
            <summary>Can I download the app on my phone?</summary>
            <p>Yes! DeutschMeister is a Progressive Web App (PWA). On Android, you should see an "Install" button. On iOS, you can tap the "Share" button in Safari and then select "Add to Home Screen" to install it.</p>
          </details>
           <details class="faq-item">
            <summary>How do I reset my password?</summary>
            <p>You can reset your password by logging out and clicking the "Forgot Password?" link on the login screen. You will receive an email with instructions to set a new password.</p>
          </details>
        </div>
      </div>

      <!-- NEW FOOTER -->
      <footer class="site-footer">
        <div class="footer-links">
            <a href="#" class="footer-link">Terms of Use</a>
            <a href="#" class="footer-link">Privacy Policy</a>
            <a href="#" class="footer-link">Accessibility</a>
            <a href="#faq" class="footer-link">FAQ</a>
            <a href="#" class="footer-link">Reviews</a>
            <a href="#" class="footer-link">Jobs</a>
            <a href="#" class="footer-link">Contact Us</a>
        </div>
        <p class="footer-copyright">© 2025 DeutschMeister</p>
      </footer>
    </main>
  </div>

  <!-- Overlays and Modals -->
  <div id="logout-modal-overlay" class="modal-overlay hidden">
    <div class="modal-box"><h3>Confirm Logout</h3><p>Are you sure you want to log out?</p>
      <div class="reset-progress-container"><input type="checkbox" id="reset-progress-checkbox"><label for="reset-progress-checkbox">Reset all my progress</label></div>
      <div class="modal-actions"><button id="cancel-logout-btn" class="btn btn-secondary">Cancel</button><button id="confirm-logout-btn" class="btn btn-danger">Logout</button></div>
    </div>
  </div>
  <div id="reset-course-modal-overlay" class="modal-overlay hidden">
    <div class="modal-box"><h3 id="reset-course-confirm-text">Reset Progress?</h3><p>This action cannot be undone.</p>
      <div class="modal-actions"><button id="cancel-reset-btn" class="btn btn-secondary">Cancel</button><button id="confirm-reset-btn" class="btn btn-danger">Confirm Reset</button></div>
    </div>
  </div>
  <div id="delete-account-modal-overlay" class="modal-overlay hidden">
    <div class="modal-box"><h3>Delete Account?</h3><p>This action cannot be undone. All your data will be permanently deleted.</p>
      <div class="modal-actions"><button id="cancel-delete-btn" class="btn btn-secondary">Cancel</button><button id="confirm-delete-btn" class="btn btn-danger">Delete Account</button></div>
    </div>
  </div>
  <div id="change-password-modal-overlay" class="modal-overlay hidden">
    <div class="modal-box"><h3>Change Password</h3><p>For your security, please confirm your current password before choosing a new one.</p>
      <form id="change-password-form" class="modal-form">
        <div class="input-group"><label for="change-current-password">Current Password</label><input type="password" id="change-current-password" required autocomplete="current-password"></div>
        <div class="input-group"><label for="change-new-password">New Password</label><input type="password" id="change-new-password" minlength="6" required autocomplete="new-password"></div>
        <p id="change-password-error" class="error-message"></p>
        <div class="modal-actions"><button type="button" id="cancel-change-password-btn" class="btn btn-secondary">Cancel</button><button type="submit" class="btn btn-primary">Save New Password</button></div>
      </form>
    </div>
  </div>
  <div id="reset-all-modal-overlay" class="modal-overlay hidden">
    <div class="modal-box"><h3>Reset All Progress?</h3><p>This will reset your progress and watched videos across ALL courses. This action cannot be undone.</p>
      <div class="modal-actions"><button id="cancel-reset-all-btn" class="btn btn-secondary">Cancel</button><button id="confirm-reset-all-btn" class="btn btn-danger">Confirm Reset</button></div>
    </div>
  </div>
  
  <!-- Scripts -->
  <script src="https://www.youtube.com/iframe_api"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js" type="module"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js" type="module"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js" type="module"></script>
  <script src="firebase.js" type="module"></script>
  <script src="youtube.js" type="module"></script>
  <script src="quiz.js" type="module"></script>
  <script src="auth.js" type="module"></script>
  <script src="app.js" type="module"></script>
  <script>
    if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('/sw.js').then(reg => console.log('SW registered.')).catch(err => console.error('SW registration failed:', err)); }); }
  </script>
</body>
</html>
